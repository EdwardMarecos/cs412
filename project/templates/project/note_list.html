{% extends 'project/base.html' %}
{% load static %}

{% block content %}
<div class="notes-page-container">
    <h2 class="mb-4">Notes</h2>

    <!-- Filter and Sort Form -->
    <form method="get" class="form-inline mb-4">
        <select name="category" class="form-control mr-2">
            <option value="">-- Filter by Category --</option>
            {% for category in categories %}
                <option value="{{ category.id }}" {% if request.GET.category == category.id|stringformat:"s" %}selected{% endif %}>
                    {{ category.name }}
                </option>
            {% endfor %}
        </select>

        <select name="subject" class="form-control mr-2">
            <option value="">-- Filter by Subject --</option>
            {% for subject in subjects %}
                <option value="{{ subject.id }}" {% if request.GET.subject == subject.id|stringformat:"s" %}selected{% endif %}>
                    {{ subject.name }}
                </option>
            {% endfor %}
        </select>

        <select name="topic" class="form-control mr-2">
            <option value="">-- Filter by Topic --</option>
            {% for topic in topics %}
                <option value="{{ topic.id }}" {% if request.GET.topic == topic.id|stringformat:"s" %}selected{% endif %}>
                    {{ topic.title }}
                </option>
            {% endfor %}
        </select>

        <input type="text" name="author" placeholder="Filter by Author" class="form-control mr-2" value="{{ get_params.author }}">
        <select name="sort" class="form-control mr-2">
            <option value="upload_date" {% if request.GET.sort == "upload_date" %}selected{% endif %}>Sort by Upload Date</option>
            <option value="title" {% if request.GET.sort == "title" %}selected{% endif %}>Sort by Title</option>
            <option value="author" {% if request.GET.sort == "author" %}selected{% endif %}>Sort by Author</option>
        </select>

        <button type="submit" class="btn btn-primary">Apply</button>
    </form>

    <!-- Notes Display -->
    <div class="notes-grid">
        {% for note in page_obj %}
            <div class="note-card">
                <div class="note-card-content">
                    <h4 class="note-title">
                        <a href="{% url 'note-detail' note.id %}">
                            {{ note.title }}
                        </a>
                    </h4>
                    <p class="note-author">
                        <strong>Author:</strong>
                        <a href="{% url 'profile-detail' note.author.id %}">
                            {{ note.author.user.username}}
                        </a>
                    </p>
                    <p class="note-preview">
                        {{ note.content|truncatewords:30 }}
                    </p>
                </div>
                <div class="note-card-footer">
                    <p class="note-meta">
                        <span>{{ note.topic.parent_subject.category.name }}</span> |
                        <span>{{ note.topic.parent_subject.name }}</span> |
                        <span>{{ note.topic.title }}</span>
                    </p>
                    <p class="note-date">
                        Uploaded: {{ note.upload_date|date:"M d, Y" }} <br>
                        {{ note.author.first_name }} {{ note.author.last_name }}
                    </p>
                </div>
            </div>
        {% empty %}
            <p class="no-notes-message">No notes available.</p>
        {% endfor %}
    </div>

    <!-- Pagination Controls -->
    <div class="pagination">
        <span class="step-links">
            {% if page_obj.has_previous %}
                <a href="?page=1">&laquo; first</a>
                <a href="?page={{ page_obj.previous_page_number }}">previous</a>
            {% endif %}

            <span class="current">
                Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}
            </span>

            {% if page_obj.has_next %}
                <a href="?page={{ page_obj.next_page_number }}">next</a>
                <a href="?page={{ page_obj.paginator.num_pages }}">last &raquo;</a>
            {% endif %}
        </span>
    </div>
</div>
{% endblock %}
