{% extends 'project/base.html' %}

{% block content %}
<div class="container mt-5">
    <h2 class="mb-4">Notes</h2>

    <!-- Filter and Sort Form -->
    <form method="get" class="form-inline mb-4">
        <select name="category" class="form-control mr-2">
            <option value="">-- Filter by Category --</option>
            {% for category in categories %}
                <option value="{{ category.id }}" {% if request.GET.category == category.id|stringformat:"s" %}selected{% endif %}>
                    {{ category.name }}
                </option>
            {% endfor %}
        </select>

        <select name="subject" class="form-control mr-2">
            <option value="">-- Filter by Subject --</option>
            {% for subject in subjects %}
                <option value="{{ subject.id }}" {% if request.GET.subject == subject.id|stringformat:"s" %}selected{% endif %}>
                    {{ subject.name }}
                </option>
            {% endfor %}
        </select>

        <select name="topic" class="form-control mr-2">
            <option value="">-- Filter by Topic --</option>
            {% for topic in topics %}
                <option value="{{ topic.id }}" {% if request.GET.topic == topic.id|stringformat:"s" %}selected{% endif %}>
                    {{ topic.title }}
                </option>
            {% endfor %}
        </select>

        <input type="text" name="author" placeholder="Filter by Author" class="form-control mr-2" value="{{ request.GET.author }}">

        <select name="sort" class="form-control mr-2">
            <option value="upload_date" {% if request.GET.sort == "upload_date" %}selected{% endif %}>Sort by Upload Date</option>
            <option value="title" {% if request.GET.sort == "title" %}selected{% endif %}>Sort by Title</option>
            <option value="author" {% if request.GET.sort == "author" %}selected{% endif %}>Sort by Author</option>
        </select>

        <button type="submit" class="btn btn-primary">Apply</button>
    </form>

    <!-- Notes Display -->
    {% for note in page_obj %}
        <div class="note-card" style="border: 1px solid #ddd; margin: 10px 0; padding: 15px; border-radius: 5px;">
            <h4>
                <a href="{% url 'note-detail' note.id %}" style="color: #1976D2; text-decoration: none;">
                    {{ note.title }}
                </a>
            </h4>
            <p><strong>Author:</strong> 
                <a href="{% url 'profile-detail' note.author.id %}">
                    {{ note.author.user.username }}
                </a>
            </p>
            <p><strong>Category:</strong> {{ note.topic.parent_subject.category.name }}</p>
            <p><strong>Subject:</strong> {{ note.topic.parent_subject.name }}</p>
            <p><strong>Topic:</strong> {{ note.topic.title }}</p>
            <p><strong>Preview:</strong> {{ note.content|truncatechars:150 }}</p>
            <p style="font-size: 12px; color: gray;">Uploaded: {{ note.upload_date|date:"F j, Y, g:i a" }}</p>
        </div>
    {% endfor %}

    <!-- Pagination Controls -->
    <div class="pagination">
        <span class="step-links">
            {% if page_obj.has_previous %}
                <a href="?page=1">&laquo; first</a>
                <a href="?page={{ page_obj.previous_page_number }}">previous</a>
            {% endif %}

            <span class="current">
                Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}
            </span>

            {% if page_obj.has_next %}
                <a href="?page={{ page_obj.next_page_number }}">next</a>
                <a href="?page={{ page_obj.paginator.num_pages }}">last &raquo;</a>
            {% endif %}
        </span>
    </div>
</div>
{% endblock %}
