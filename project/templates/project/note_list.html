<!-- File: note_list.html -->
<!-- Author: Edward Marecos (emarecos@bu.edu), 12/1/2024 -->
<!-- Description: Template for displaying a paginated list of notes. This page includes options to filter, sort, and interact with notes, such as liking and bookmarking. -->

{% extends 'project/base.html' %}
{% load static %}

{% block content %}
<div class="notes-page-container-a">
    <h2 class="mb-4">Notes</h2>

    <!-- Filter and Sort Form -->
    <form method="get" class="form-inline mb-4">
        <select name="category" class="form-control mr-2">
            <option value="">-- Filter by Category --</option>
            {% for category in categories %}
                <option value="{{ category.id }}" {% if request.GET.category == category.id|stringformat:"s" %}selected{% endif %}>
                    {{ category.name }}
                </option>
            {% endfor %}
        </select>

        <select name="subject" class="form-control mr-2">
            <option value="">-- Filter by Subject --</option>
            {% for subject in subjects %}
                <option value="{{ subject.id }}" {% if request.GET.subject == subject.id|stringformat:"s" %}selected{% endif %}>
                    {{ subject.name }}
                </option>
            {% endfor %}
        </select>

        <select name="topic" class="form-control mr-2">
            <option value="">-- Filter by Topic --</option>
            {% for topic in topics %}
                <option value="{{ topic.id }}" {% if request.GET.topic == topic.id|stringformat:"s" %}selected{% endif %}>
                    {{ topic.title }}
                </option>
            {% endfor %}
        </select>

        <input type="text" name="author" placeholder="Filter by Author" class="form-control mr-2" value="{{ get_params.author }}">
        <select name="sort" class="form-control mr-2">
            <option value="upload_date" {% if request.GET.sort == "upload_date" %}selected{% endif %}>Sort by Upload Date</option>
            <option value="title" {% if request.GET.sort == "title" %}selected{% endif %}>Sort by Title</option>
            <option value="author" {% if request.GET.sort == "author" %}selected{% endif %}>Sort by Author</option>
        </select>

        <button type="submit" class="btn btn-primary">Apply</button>
    </form>

    <!-- Notes Display -->
    <div class="notes-grid-a">
        {% for note in page_obj %}
            <div class="note-card-a">
                <div class="interaction-display-a">
                    <!-- Like Display -->
                    <div class="like-display-a {% if request.user.project_profile in note.liked_by.all %}liked{% endif %}">
                        <i class="fas fa-heart"></i>
                        <span class="like-count-a">{{ note.like_count }}</span>
                    </div>
                    <!-- Bookmark Display -->
                    <div class="bookmark-display-a {% if request.user.project_profile in note.bookmarked_by.all %}bookmarked{% endif %}">
                        <i class="fas fa-bookmark"></i>
                        <span class="bookmark-count-a">{{ note.bookmark_count }}</span>
                    </div>
                </div>
                <div class="note-card-content-a">
                    <h4 class="note-title-a">
                        <a href="{% url 'note-detail' note.id %}">
                            {{ note.title }}
                        </a>
                    </h4>
                    <p class="note-author-a">
                        <strong>Author:</strong>
                        <a href="{% url 'profile-detail' note.author.id %}">{{ note.author.user.username }}</a>
                    </p>
                    <p class="note-preview-a">
                        {{ note.content|truncatewords:30 }}
                    </p>
                </div>
                <div class="note-card-footer-a">
                    <p class="note-meta-a">
                        <span>{{ note.topic.parent_subject.category.name }}</span> |
                        <span>{{ note.topic.parent_subject.name }}</span> |
                        <span>{{ note.topic.title }}</span>
                    </p>
                    <p class="note-date-a">
                        Uploaded: {{ note.upload_date|date:"M d, Y" }}<br>
                        {{ note.author.first_name }} {{ note.author.last_name }}
                    </p>
                </div>
            </div>
        {% empty %}
            <p class="no-notes-message">No notes available.</p>
        {% endfor %}
    </div>
    

    <!-- Pagination Controls -->
    <div class="pagination-a">
        <span class="step-links-a">
            {% if page_obj.has_previous %}
                <a href="?page=1">&laquo; first</a>
                <a href="?page={{ page_obj.previous_page_number }}">previous</a>
            {% endif %}

            <span class="current-a">
                Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}
            </span>

            {% if page_obj.has_next %}
                <a href="?page={{ page_obj.next_page_number }}">next</a>
                <a href="?page={{ page_obj.paginator.num_pages }}">last &raquo;</a>
            {% endif %}
        </span>
    </div>
</div>
{% endblock %}
