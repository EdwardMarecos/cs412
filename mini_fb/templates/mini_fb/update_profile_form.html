<!-- templates/mini_fb/update_profile_form.html -->

<!-- 
 labels for each field to show what input is expected. 
 Upon submission, your form will be handled by the generic 
 UpdateView class, which will update the Profile record for 
 this model and store the update in the database.
-->


{% extends 'mini_fb/base.html' %}

{% block content %}
<div class="container" style="
    max-width: 600px; 
    padding: 30px; 
    background-color: #f9f9f9; 
    border-radius: 15px; 
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);">
    
    <h2 style="text-align: center; margin-bottom: 20px; color: #1976D2;">
        Update Profile for {{form.instance.first_name}} {{form.instance.last_name}}
    </h2>

    <!-- Display current profile picture at the top center -->
    <div style="display: flex; justify-content: center; margin-bottom: 20px;">
        <img src="{{ form.instance.get_profile_image }}" alt="Current Profile Image" 
             style="width: 150px; height: 150px; border-radius: 15%; object-fit: cover; 
                    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);">
    </div>

    <form method="POST" enctype="multipart/form-data">
        {% csrf_token %}
        
        {{ form.non_field_errors }}

        <!-- Loop through the fields except the file input -->
        {% for field in form %}
        {% if field.name != 'profile_img_file' and field.name != 'clear_profile_image' %}
        <div style="display: flex; flex-direction: column; gap: 8px;">
            <label for="{{ field.id_for_label }}" style="
                font-weight: bold; 
                color: #1976D2;">
                {{ field.label }}
            </label>

            <!-- Check if the field is the birth date field -->
            {% if field.name == 'birth_date' %}
            <div class="birth-date-container" style="display: flex; gap: 10px;">
                {{ field }}
            </div>
            {% else %}
            <div style="display: flex; flex-direction: column;">
                {{ field }}
            </div>
            {% endif %}

            <!-- Display field errors -->
            <div style="color: red;">
                {{ field.errors }}
            </div>
        </div>
        {% endif %}
        {% endfor %}

        <!-- Custom File Input Button -->
        <div style="display: flex; flex-direction: column; gap: 8px;">
            <label for="profile_img_file" style="
                font-weight: bold; 
                color: #1976D2;">
                Change Profile Picture:
            </label>
            
            <div style="display: flex; align-items: center; gap: 20px;">
                <!-- File Input and Button -->
                <div class="custom-file-input">
                    <button type="button" id="upload-btn">Choose File</button>
                    <span id="file-chosen">No file chosen</span>
                    <input type="file" name="profile_img_file" id="real-file" hidden />
                </div>

                <!-- Image Preview to the right -->
                <div id="image-preview" style="width: 100px; height: 100px;">
                    <!-- Image will be dynamically inserted here -->
                </div>
            </div>
        </div>

        <!-- Checkbox to reset profile picture -->
        <div style="margin-top: 0px; margin-bottom: 35px; display: flex; align-items: center; gap: 10px;">
            <input type="checkbox" id="clear_profile_image" name="clear_profile_image" 
                style="width: 20px; height: 20px; cursor: pointer;">
            <label for="clear_profile_image" style="font-weight: bold; color: #1976D2; cursor: pointer;">
                or remove your profile picture
            </label>
        </div>

        <div>
            <button type="submit" style="
            background-color: #FFC107;
            color: black;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            font-size: 18px;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.1s ease;
            font-family: 'Arial', sans-serif;"
            onmouseover="this.style.backgroundColor='#FFB300';"
            onmouseout="this.style.backgroundColor='#FFC107';">
            Save Changes
            </button>
        </div>
    </form>
</div>

<script>
    // JavaScript to handle custom file input behavior
    const realFileBtn = document.getElementById('real-file');
    const uploadBtn = document.getElementById('upload-btn');
    const fileChosen = document.getElementById('file-chosen');
    const preview = document.getElementById('image-preview');

    uploadBtn.addEventListener('click', () => realFileBtn.click());

    realFileBtn.addEventListener('change', event => {
        const file = event.target.files[0];
        fileChosen.textContent = file ? file.name : 'No file chosen';
        preview.innerHTML = '';  // Clear previous preview

        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const img = document.createElement('img');
                img.src = e.target.result;
                img.style.width = '100px';
                img.style.height = '100px';
                img.style.objectFit = 'cover';
                img.style.borderRadius = '15%';
                img.style.boxShadow = '0 2px 4px rgba(0, 0, 0, 0.1)';
                preview.appendChild(img);
            };
            reader.readAsDataURL(file);
        }
    });
</script>

<style>
    /* Consistent Styling for Form Fields */
    input, textarea {
        width: 100%;
        padding: 10px;
        margin-top: 5px;
        border: 1px solid #42A5F5;
        border-radius: 5px;
        font-size: 16px;
        font-family: 'Arial', sans-serif;
        box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
        transition: border-color 0.3s ease;
    }

    select {
        width: 25%;
        padding: 10px;
        margin-top: 5px;
        border: 1px solid #42A5F5;
        border-radius: 5px;
        font-size: 16px;
        font-family: 'Arial', sans-serif;
        box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
        transition: border-color 0.3s ease;
    }

    input:focus, textarea:focus, select:focus {
        border-color: #42A5F5;
        outline: none;
    }

    .custom-file-input {
        display: flex;
        align-items: center;
        gap: 10px;
    }

    #upload-btn {
        background-color: #42A5F5;
        color: white;
        padding: 10px 15px;
        border: none;
        border-radius: 5px;
        font-size: 16px;
        cursor: pointer;
        transition: background-color 0.3s ease;
    }

    #upload-btn:hover {
        background-color: #1E88E5;
    }

    #file-chosen {
        font-size: 14px;
        color: #666;
    }
</style>
{% endblock %}
